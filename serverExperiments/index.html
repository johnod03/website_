
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr">
		<meta name="apple-touch-fullscreen" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="http://www.janmech.net/sites/default/files/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/32" />
<link rel="canonical" href="/jmpubnub" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>jm.pubNub | janmech.net</title>
  <link type="text/css" rel="stylesheet" href="http://www.janmech.net/sites/default/files/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="http://www.janmech.net/sites/default/files/css/css_GkP1xbigU_DhVxzZsSNzf-eghVYQ3uXuV83Tst8l5EM.css" media="all" />
<link type="text/css" rel="stylesheet" href="http://www.janmech.net/sites/default/files/css/css_MnXiytJtb186Ydycnpwpw34cuUsHaKc80ey5LiQXhSY.css" media="all" />
<link type="text/css" rel="stylesheet" href="http://www.janmech.net/sites/default/files/css/css_zY1eH8xhqCmUe-v9T_fsudT-d7pEP6oQZOWRneurcTU.css" media="all" />
  <script type="text/javascript" src="http://www.janmech.net/sites/default/files/js/js_xAPl0qIk9eowy_iS9tNkCWXLUVoat94SQT48UBCFkyQ.js"></script>
<script type="text/javascript" src="http://www.janmech.net/sites/default/files/js/js_Tcwnr_qcqUIrmippZtoaeNxV9r6rAL8FhqbdJEhK-cc.js"></script>
<script type="text/javascript" src="http://www.janmech.net/sites/default/files/js/js_7VakS0FS0W7ptwD6gE8tKo_GBOHrNlSs8WQvjyF1nqk.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<style> 
		#no {
			display: none;	
		}
		
		@media screen {
			html, body, div, span {
				margin: 0;
			  padding: 0;
			  border: 0;
			  outline: 0;
			  font-size: 100%;
			  vertical-align: baseline;
			}			
			body {
				height: auto;
		  	-webkit-text-size-adjust:none;
		  	font-family:Helvetica, Arial, Verdana, sans-serif;
		  	padding:0px;
				overflow-x: hidden;		
			}		
			
			.outer {
				background: rgba(123, 256, 245, 0.9);
				padding: 0px;
				min-height: 48px;
				
			}
			
			.box {
				position: relative;
				float: left;
				width: 45%;
				padding: 7px;
				border: 1px solid rgba(255, 255, 255, 0.6);
				background: rgba(178,215,255,0.75);
				min-height: 160px;
			}	
			
			.box2 {
				position: relative;
				float: left;
				width: 45%;
				padding: 7px;
				border: 1px solid rgba(255, 255, 255, 0.6);
				background: rgba(178,215,255,0.75);
			}	
			
			.box span {
				display: block;
			}
			
			span.head {
				font-weight: bold;				
			}
		
		}
		</style> 

</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-32 node-type-page" >
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
<div class="pageWrapper">   
</div>
	<div id="content" class="content pageContent">
		<div id="messages">
			<div class="messagesWrapper">
			</div>
		</div>
		  <div class="region region-content">
    		<div id="block-system-main" class="block block-system">
  				<div class="content">
   					 <div id="node-32" class="node node-page clearfix">
     
  						<div class="content">
     					 </div>  
					</div>
 				 </div>
			</div>
  		</div>
		<div id="jmpubnubWrapper">
			<script src="http://cdn.pubnub.com/pubnub-3.7.1.min.js"></script>
			<div class="mainCont">

				<h1>Max (or maybe some else) says:</h1>
				<h2>
					<span id="jmPubNubDisplay">[nothing yet]</span>
				</h2>
				<div class="jmPubNubPublish">
					<h1>Type and send to Max:</h1>
					<span class="jmPubNubSmall">(using channel: "jmPubNub1", subscribekey: "demo", publishkey: "demo")</span>
					<form id="publishForm" action="" onsubmit="sendToMax(); return false;">
						<div>
							<textarea id="thisWillGoToMax" name = "thisWillGoToMax" cols="40"></textarea>
						</div>
						<input type="button" value="Send" id="sendToMax">
					</form>
        <div id="yes"> 
				<div class="box" id="accel">
					<span class="head">Accelerometer</span>
					<span id="xlabel"></span>
					<span id="ylabel"></span>
					<span id="zlabel"></span>
					<span id="ilabel"></span>					
					<span id="arAlphaLabel"></span>										
					<span id="arBetaLabel"></span>										
					<span id="arGammaLabel"></span>																				
				</div>			
				<div class="box" id="gyro">
					<span class="head">Gyroscope</span>
					<span id="alphalabel"></span>			
					<span id="betalabel"></span>
					<span id="gammalabel"></span>
				</div>	
				<div class="box2" id="accelcolor">
					<span class="head">Color</span>
				</div>
				<div class="box2" id="gyrocolor">
					<span class="head">Color</span>
				</div>
				<input type="button" value= "sendToText" id="sendToTextArea">
                
		</div>
		<div id="no">
			Your browser does not support Device Orientation and Motion API. Try this sample with iPhone, iPod or iPad with iOS 4.2+.    
		</div>
       		
</div>
	


	<script> 
		$('#sendToTextArea').on('click',function(){
			var arr = new Array();
			
			arr.push(ax);
			arr.push(ay);
			arr.push(az);

			//document.getElementsByName('thisWillGoToMax')[0].value = arr[0,1,2];
			document.getElementById('thisWillGoToMax').innerHTML = arr;
			});
			
		jQuery("#sendToMax").click(function(){
			sendToMax();
				});
					var pubnub = PUBNUB.init({
						publish_key   : 'demo',
						subscribe_key : 'demo'
					});
					function sendToMax(form) {
						console.log("here");
						pubnub.publish({
							channel : 'jmPubNub1',
							message : {"theWebSiteSays" : jQuery("#thisWillGoToMax").val()}
						});
						jQuery("#thisWillGoToMax").val('');
					}
					pubnub.subscribe({
						channel  : "jmPubNub1",      // CONNECT TO THIS CHANNEL.
						error    : function() {        // LOST CONNECTION (auto reconnects)
							alert("Connection Lost. Will auto-reconnect when Online.")
						},
						callback : function(fromMax) { // RECEIVED A MESSAGE.
							if(fromMax.value != undefined) {
								jQuery("#jmPubNubDisplay").text(fromMax.value);
							}
						}
					})
			
			// Position Variables
			var x = 0;
			var y = 0;
			var z = 0;

			// Speed - Velocity
			var vx = 0;
			var vy = 0;
			var vz = 0;

			// Acceleration
			var ax = 0;
			var ay = 0;
			var az = 0;
			var ai = 0;
			var arAlpha = 0;
			var arBeta = 0;
			var arGamma = 0;

			var delay = 100;
			var vMultiplier = 0.01;			var alpha = 0;
		
			var alpha = 0;
			var beta = 0;
			var gamma = 0;
			
			
			if (window.DeviceMotionEvent==undefined) {
				document.getElementById("no").style.display="block";
				document.getElementById("yes").style.display="none";
			} 
			else {
				window.ondevicemotion = function(event) {
					ax = Math.round(Math.abs(event.accelerationIncludingGravity.x * 1));
					ay = Math.round(Math.abs(event.accelerationIncludingGravity.y * 1));
					az = Math.round(Math.abs(event.accelerationIncludingGravity.z * 1));		
					ai = Math.round(event.interval * 100) / 100;
					rR = event.rotationRate;
					if (rR != null) {
						arAlpha = Math.round(rR.alpha);
						arBeta = Math.round(rR.beta);
						arGamma = Math.round(rR.gamma);
					}

/*					
					ax = Math.abs(event.acceleration.x * 1000);
					ay = Math.abs(event.acceleration.y * 1000);
					az = Math.abs(event.acceleration.z * 1000);		
	*/				
				}
								
				window.ondeviceorientation = function(event) {
					alpha = Math.round(event.alpha);
					beta = Math.round(event.beta);
					gamma = Math.round(event.gamma);
				}				
				
				function d2h(d) {return d.toString(16);}
				function h2d(h) {return parseInt(h,16);}
				
				function makecolor(a, b, c) {
					red = Math.abs(a) % 255;
					green = Math.abs(b) % 255;
					blue = Math.abs(c) % 255;
					return "#" + d2h(red) + d2h(green) + d2h(blue);
				}
				
				function makeacceleratedcolor(a, b, c) {
					red = Math.round(Math.abs(a + az) % 255);
					green = Math.round(Math.abs(b + ay) % 255);
					blue = Math.round(Math.abs(c + az) % 255);
					return "#" + d2h(red) + d2h(green) + d2h(blue);
				}
 
				setInterval(function() {
					document.getElementById("xlabel").innerHTML = "X: " + ax;
					document.getElementById("ylabel").innerHTML = "Y: " + ay;
					document.getElementById("zlabel").innerHTML = "Z: " + az;										
					document.getElementById("ilabel").innerHTML = "I: " + ai;										
					document.getElementById("arAlphaLabel").innerHTML = "arA: " + arAlpha;															
					document.getElementById("arBetaLabel").innerHTML = "arB: " + arBeta;
					document.getElementById("arGammaLabel").innerHTML = "arG: " + arGamma;																									
					document.getElementById("alphalabel").innerHTML = "Alpha: " + alpha;
					document.getElementById("betalabel").innerHTML = "Beta: " + beta;
					document.getElementById("gammalabel").innerHTML = "Gamma: " + gamma;

					document.getElementById("accelcolor").innerHTML = "Color: " + makecolor(ax, ay, az);
					document.getElementById("accelcolor").style.background = makecolor(ax, ay, az);
					document.getElementById("accelcolor").style.color = "#FFFFFF";
					document.getElementById("accelcolor").style.fontWeight = "bold";

					document.getElementById("gyrocolor").innerHTML = "Color: " + makecolor(alpha, beta, gamma);
					document.getElementById("gyrocolor").style.background = makecolor(alpha, beta, gamma);
					document.getElementById("gyrocolor").style.color = "#FFFFFF";
					document.getElementById("gyrocolor").style.fontWeight = "bold";

					document.bgColor = makecolor(arAlpha, arBeta, arGamma);

				}, delay);
			} 
			 
			
			</script> 

			</div>
		</div>
	</div>
	

<!--[if lt IE 9]>
</div>
<![endif]-->
  </body>
</html>
